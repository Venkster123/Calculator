#!/bin/bash

if [ ! -f train-labels-idx1-ubyte ]; then
	wget http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz

	gunzip train-labels-idx1-ubyte.gz
fi

if [ ! -f train-images-idx3-ubyte ]; then
	wget http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz

	gunzip train-images-idx3-ubyte.gz
fi

if [ "$1" == "debug" ]; then
	cmake -DCMAKE_BUILD_TYPE=Debug .
else
	cmake -DCMAKE_BUILD_TYPE=Debug .
fi

make

mkdir -p bin

mv mnist bin/

if [ "$1" == "debug" ]; then
	valgrind --leak-check=full --track-origins=yes ./bin/mnist 2>vgrind.out
else
	./bin/mnist
fi
